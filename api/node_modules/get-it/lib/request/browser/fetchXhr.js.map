{"version":3,"sources":["../../../src/request/browser/fetchXhr.js"],"names":["FetchXhr","readyState","prototype","open","method","url","_method","_url","_resHeaders","onreadystatechange","abort","_controller","getAllResponseHeaders","setRequestHeader","key","value","_headers","send","body","ctrl","AbortController","textBody","responseType","options","headers","signal","window","credentials","withCredentials","fetch","then","res","forEach","status","statusText","text","arrayBuffer","resBody","responseText","response","catch","err","name","onabort","onerror","module","exports"],"mappings":"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","sourcesContent":["/**\n * Mimicks the XMLHttpRequest API with only the parts needed for get-it's XHR adapter\n */\nfunction FetchXhr() {\n  this.readyState = 0 // Unsent\n}\nFetchXhr.prototype.open = function(method, url) {\n  this._method = method\n  this._url = url\n  this._resHeaders = ''\n  this.readyState = 1 // Open\n  this.onreadystatechange()\n}\nFetchXhr.prototype.abort = function() {\n  if (this._controller) {\n    this._controller.abort()\n  }\n}\nFetchXhr.prototype.getAllResponseHeaders = function() {\n  return this._resHeaders\n}\nFetchXhr.prototype.setRequestHeader = function(key, value) {\n  this._headers = this._headers || {}\n  this._headers[key] = value\n}\nFetchXhr.prototype.send = function(body) {\n  // eslint-disable-next-line no-multi-assign\n  const ctrl = (this._controller = typeof AbortController === 'function' && new AbortController())\n  const textBody = this.responseType !== 'arraybuffer'\n  const options = {\n    method: this._method,\n    headers: this._headers,\n    signal: ctrl && ctrl.signal,\n    body\n  }\n\n  // Some environments (like CloudFlare workers) don't support credentials in\n  // RequestInitDict, and there doesn't seem to be any easy way to check for it,\n  // so for now let's just make do with a window check :/\n  if (typeof window !== 'undefined') {\n    options.credentials = this.withCredentials ? 'include' : 'omit'\n  }\n\n  fetch(this._url, options)\n    .then(res => {\n      res.headers.forEach((value, key) => {\n        this._resHeaders += `${key}: ${value}\\r\\n`\n      })\n      this.status = res.status\n      this.statusText = res.statusText\n      this.readyState = 3 // Loading\n      return textBody ? res.text() : res.arrayBuffer()\n    })\n    .then(resBody => {\n      if (textBody) {\n        this.responseText = resBody\n      } else {\n        this.response = resBody\n      }\n      this.readyState = 4 // Done\n      this.onreadystatechange()\n    })\n    .catch(err => {\n      if (err.name === 'AbortError') {\n        this.onabort()\n        return\n      }\n\n      this.onerror(err)\n    })\n}\n\nmodule.exports = FetchXhr\n"],"file":"fetchXhr.js"}