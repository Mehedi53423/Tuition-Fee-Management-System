"use strict";var w=Object.defineProperty,A=Object.defineProperties;var B=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable;var _=(e,t,n)=>t in e?w(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,g=(e,t)=>{for(var n in t||(t={}))K.call(t,n)&&_(e,n,t[n]);if(x)for(var n of x(t))C.call(t,n)&&_(e,n,t[n]);return e},I=(e,t)=>A(e,B(t));Object.defineProperty(exports,"__esModule",{value:!0});exports[Symbol.toStringTag]="Module";function h(e){return e._type==="span"&&"text"in e&&typeof e.text=="string"&&(typeof e.marks=="undefined"||Array.isArray(e.marks)&&e.marks.every(t=>typeof t=="string"))}function k(e){return typeof e._type=="string"&&e._type[0]!=="@"&&(!("markDefs"in e)||Array.isArray(e.markDefs)&&e.markDefs.every(t=>typeof t._key=="string"))&&"children"in e&&Array.isArray(e.children)&&e.children.every(t=>typeof t=="object"&&"_type"in t)}function P(e){return k(e)&&"listItem"in e&&typeof e.listItem=="string"&&(typeof e.level=="undefined"||typeof e.level=="number")}function L(e){return e._type==="@list"}function S(e){return e._type==="@span"}function b(e){return e._type==="@text"}const v=["strong","em","code","underline","strike-through"];function M(e,t,n){if(!h(e)||!e.marks)return[];if(!e.marks.length)return[];const r=e.marks.slice(),l={};return r.forEach(i=>{l[i]=1;for(let s=t+1;s<n.length;s++){const c=n[s];if(c&&h(c)&&Array.isArray(c.marks)&&c.marks.indexOf(i)!==-1)l[i]++;else break}}),r.sort((i,s)=>N(l,i,s))}function N(e,t,n){const r=e[t],l=e[n];if(r!==l)return l-r;const i=v.indexOf(t),s=v.indexOf(n);return i!==s?i-s:t.localeCompare(n)}function j(e){var s;const{children:t,markDefs:n=[]}=e;if(!t||!t.length)return[];const r=t.map(M),l={_type:"@span",children:[],markType:"<unknown>"};let i=[l];for(let c=0;c<t.length;c++){const f=t[c];if(!f)continue;const T=r[c]||[];let p=1;if(i.length>1)for(p;p<i.length;p++){const a=((s=i[p])==null?void 0:s.markKey)||"",o=T.indexOf(a);if(o===-1)break;T.splice(o,1)}i=i.slice(0,p);let u=i[i.length-1];if(!!u){for(const a of T){const o=n.find(D=>D._key===a),O=o?o._type:a,d={_type:"@span",_key:f._key,children:[],markDef:o,markType:O,markKey:a};u.children.push(d),i.push(d),u=d}if(h(f)){const a=f.text.split(`
`);for(let o=a.length;o-- >1;)a.splice(o,0,`
`);u.children=u.children.concat(a.map(o=>({_type:"@text",text:o})))}else u.children=u.children.concat(f)}}return l.children}function H(e,t){const n=[];let r;for(let l=0;l<e.length;l++){const i=e[l];if(!!i){if(!P(i)){n.push(i),r=void 0;continue}if(!r){r=y(i,l,t),n.push(r);continue}if(R(i,r)){r.children.push(i);continue}if((i.level||1)>r.level){const s=y(i,l,t);if(t==="html"){const c=r.children[r.children.length-1],f=I(g({},c),{children:[...c.children,s]});r.children[r.children.length-1]=f}else r.children.push(s);r=s;continue}if((i.level||1)<r.level){const s=n[n.length-1],c=s&&m(s,i);if(c){r=c,r.children.push(i);continue}r=y(i,l,t),n.push(r);continue}if(i.listItem!==r.listItem){const s=n[n.length-1],c=s&&m(s,{level:i.level||1});if(c&&c.listItem===i.listItem){r=c,r.children.push(i);continue}else{r=y(i,l,t),n.push(r);continue}}console.warn("Unknown state encountered for block",i),n.push(i)}}return n}function R(e,t){return(e.level||1)===t.level&&e.listItem===t.listItem}function y(e,t,n){return{_type:"@list",_key:`${e._key||`${t}`}-parent`,mode:n,level:e.level||1,listItem:e.listItem,children:[e]}}function m(e,t){const n=t.level||1,r=t.listItem||"normal",l=typeof t.listItem=="string";if(L(e)&&(e.level||1)===n&&l&&(e.listItem||"normal")===r)return e;if(!("children"in e))return;const i=e.children[e.children.length-1];return i&&!h(i)?m(i,t):void 0}const $=/^\s/,F=/^\s/;function U(e){const t=Array.isArray(e)?e:[e];let n="";return t.forEach((r,l)=>{if(!k(r))return;let i=!1;r.children.forEach(s=>{h(s)?(n+=i&&n&&!F.test(n)&&!$.test(s.text)?" ":"",n+=s.text,i=!1):i=!0}),l!==t.length-1&&(n+=`

`)}),n}function E(e){let t="";return e.children.forEach(n=>{b(n)?t+=n.text:S(n)&&(t+=E(n))}),t}const q="html",z="direct";exports.LIST_NEST_MODE_DIRECT=z;exports.LIST_NEST_MODE_HTML=q;exports.buildMarksTree=j;exports.isPortableTextBlock=k;exports.isPortableTextListItemBlock=P;exports.isPortableTextSpan=h;exports.isPortableTextToolkitList=L;exports.isPortableTextToolkitSpan=S;exports.isPortableTextToolkitTextNode=b;exports.nestLists=H;exports.sortMarksByOccurences=M;exports.spanToPlainText=E;exports.toPlainText=U;
//# sourceMappingURL=portable-text-toolkit.js.map
