"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.resolveTypeForDocument = resolveTypeForDocument;

var _rxjs = require("rxjs");

var _operators = require("rxjs/operators");

var _draftUtils = require("../../util/draftUtils");

var _versionedClient = require("../../client/versionedClient");

function resolveTypeForDocument(id) {
  var specifiedType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '*';

  // if is resolved document type
  if (specifiedType && specifiedType !== '*') {
    return (0, _rxjs.of)(specifiedType);
  }

  var query = '*[_id in [$documentId, $draftId]]._type';
  var documentId = (0, _draftUtils.getPublishedId)(id);
  var draftId = (0, _draftUtils.getDraftId)(documentId);
  return _versionedClient.versionedClient.observable.fetch(query, {
    documentId,
    draftId
  }).pipe((0, _operators.map)(types => types[0]));
}