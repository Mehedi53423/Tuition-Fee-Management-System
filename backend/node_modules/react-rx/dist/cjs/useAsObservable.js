"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.useAsObservable = void 0;
var rxjs_1 = require("rxjs");
var react_1 = require("react");
var useIsomorphicEffect_1 = require("./useIsomorphicEffect");
function useAsObservable(value, operator) {
    var isInitial = (0, react_1.useRef)(true);
    var subjectRef = (0, react_1.useRef)(new rxjs_1.BehaviorSubject(value));
    var observableRef = (0, react_1.useRef)();
    if (!observableRef.current) {
        var observable = subjectRef.current.asObservable();
        observableRef.current = operator ? observable.pipe(operator) : observable;
    }
    (0, useIsomorphicEffect_1.useIsomorphicEffect)(function () {
        if (isInitial.current) {
            isInitial.current = false;
        }
        else {
            // emit only on update
            subjectRef.current.next(value);
        }
    }, [value]);
    (0, useIsomorphicEffect_1.useIsomorphicEffect)(function () {
        return function () {
            return subjectRef.current.complete();
        };
    }, []);
    return observableRef.current;
}
exports.useAsObservable = useAsObservable;
